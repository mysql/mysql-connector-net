<?xml version="1.0" encoding="utf-8"?>
<Project ToolsVersion="3.5" xmlns="http://schemas.microsoft.com/developer/msbuild/2003">

<UsingTask AssemblyFile="MyCustomTasks.dll" TaskName="MyCustomTasks.MyEntityDeploySetLogicalNames" />


	  <Target Name="EntityDeploySetLogicalNames"
			  DependsOnTargets="EntityDeploySplit">


		<Exec Command="echo ***Overriding entity Deploy in 4.0***" />

		<!-- First define the resources to be embedded
			 Note: ignore resources which are not in @(EntityDeployEmbeddingItems) - this ignores
			 resources generated by previous runs which have now had their MetadataArtifactProcessing 
			 changed to "CopyToOutput" -->
		<ItemGroup>
		  <EntityDeployResourcesToEmbed Include="@(EntityDeployEmbeddingItems->'$(EntityDeployIntermediateResourcePath)%(EntityDeployRelativeDir)%(Filename).csdl')" />
		  <EntityDeployResourcesToEmbed Include="@(EntityDeployEmbeddingItems->'$(EntityDeployIntermediateResourcePath)%(EntityDeployRelativeDir)%(Filename).msl')" />
		  <EntityDeployResourcesToEmbed Include="@(EntityDeployEmbeddingItems->'$(EntityDeployIntermediateResourcePath)%(EntityDeployRelativeDir)%(Filename).ssdl')" />
		</ItemGroup>

		<Message Condition="'$(EntityDeployDebug)'=='true'"
				 Text="Debugging EntityDeploySetLogicalNames: EntityDeployResourcesToEmbed = @(EntityDeployResourcesToEmbed)" />

		<!-- Now update their logical names and add them to the list of resources to be embedded -->
		<MyEntityDeploySetLogicalNames
			  Sources="@(EntityDeployResourcesToEmbed)"
			  ResourceOutputPath="$(EntityDeployIntermediateResourcePath)" >
		  <Output TaskParameter="ResourcesToEmbed" ItemName="EmbeddedResource"/>
		</MyEntityDeploySetLogicalNames>

	  </Target>

</Project>